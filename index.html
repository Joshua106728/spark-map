<!DOCTYPE html>
<html>
<head>
	<title>Spark STL Map</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css">
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<style>
		  body { margin:0; padding:0; }
		  #map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
	
</head>
<body>
	<div id="map"></div>
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
		<script src="https://unpkg.com/@turf/turf@3.5.2/turf.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="data/stl-buildings.geojson" type="text/javascript"></script>
		<script src="data/teamO-ways.geojson" type="text/javascript"></script>
		<script src="data/teamE-ways.geojson" type="text/javascript"></script>
		<script src="data/teamE-buildings.geojson" type="text/javascript"></script>
	<script type="text/javascript">

		/* Map Variables */


		// Set URLs for the GeoJSONs we will be using
		var buildingsURL = "data/stl-buildings.geojson";
		var OwaysURL = "data/teamO-ways.geojson";
		var EwaysURL = "data/teamE-ways.geojson";
		var EbuildingsURL = "data/teamE-buildings.geojson";
		
		// Create the map variable
		var map = L.map('map')
			.setView([38.6533, -90.2424], 11)
			.on('click', onMapClick);

		// Add OSM Title Layer
		var osmTiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
      		}).addTo(map);

		var esriImagery = L.tileLayer('https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/16749/{z}/{y}/{x}').addTo(map);

		// What if we want to style based on property?
		//style: function(feature) {
		//	 switch(feature.properties.building) {
		//		 case 'house': return houseStyle;
		//			 break;
		//		 case 'apartment': return apartmentStyle;
		//			 break;
		//		 case 'shed': return shedStyle;
		//			 break;
		//		 default: return buildingsStyle;
		//			 break;
		//	 }
		// }

		// What if we want to have custom messages for each layer?
		/* Only use this if using GeoJSON from Overpass */
		/*
		var osmURL = ""
		// Try to get the name of the feature
		if (feature.properties && feature.properties.name) {
			popupTxt += `<b>${feature.properties.name}</b>`;
		}

	    // does this feature have a property named id?
	    if (feature.properties && feature.properties['@id']) {
	    	// Excellent! We can now link directly to the feature
	    	osmURL = `https://www.openstreetmap.org/${feature.properties['@id']}`
	    } else if (feature.properties && feature.geometry.coordinates) {
	    	// Since we don't have the ID, let's try for the centroid of the feature
	    	var centroid;
	    	if (feature.geometry.type === 'Polygon') {
	    		centroid = turf.centroid(feature).geometry.coordinates;
	    	}
	    	osmURL = `https://www.openstreetmap.org/edit/#map=${map.getZoom()}/${centroid[0]}/${centroid[0]}`;
	    }

	    if (osmURL != "") {
	    	popupTxt += `</br></br>View this feature on <a target="_blank" href=${osmURL}>OSM</a>!`
	    }
	    */
	    /* End Comments */

		// Set style for buildings
		var buildingsStyle = {
			color: "#E22B2B", 
			weight: 5, 
			opacity: 0.70
		};
		
		var houseStyle = {
			color: "rgb(141,28,176)", 
			weight: 5, 
			opacity: 0.55
		};
		
		var apartmentStyle = {
			color: "rgb(57,168,13)", 
			weight: 4, 
			opacity: 0.50
		};
		
		var shedStyle = {
			color: "rgb(94,108,125)", 
			weight: 2, 
			opacity: 0.30
		};

		var otherStyle = {
			color: "#FFFF00", 
			weight: 5, 
			opacity: 0.5
		};

		// Add buildings layer
		var buildingsLayer = L.geoJSON(null, {
			// Change the style based on property
			style: function(feature) {
			    switch(feature.properties.building) {
				 case 'house': return houseStyle;
					 break;
				 case 'apartment': return apartmentStyle;
					 break;
				 case 'shed': return shedStyle;
					 break;
				 default: return buildingsStyle;
					 break;
				}
		        },
			onEachFeature: function(feature, layer) {
				var popupTxt = "You clicked a magnificent, spectacular feature!";
				layer.bindPopup(popupTxt);
			
				//if(layer === buildingsLayer){
			//var popupTxt = "You clicked a magnificent, wonderful building feature!";
			//layer.bindPopul(popupTxt);
			//}
			}
		});

		$.getJSON(buildingsURL, function(data){
			buildingsLayer.addData(data).addTo(map);
		})
		
		// Set style for ways
		var OwaysStyle = {
			color: "#E22B2B", 
			weight: 5, 
			opacity: 0.70
		};

		// Add ways layer
		var OwaysLayer = L.geoJSON(null, {
			style: OwaysStyle,
			onEachFeature: function(feature, layer) {
				var popupTxt = "You clicked a great feature!";
				layer.bindPopup(popupTxt);
			}
		});

		$.getJSON(OwaysURL, function(data){
			OwaysLayer.addData(data).addTo(map);
			
		});

		// Set style for ways
		var EwaysStyle = {
			color: "#E22B2B", 
			weight: 5, 
			opacity: 0.70
		};

		// Add ways layer
		var EwaysLayer = L.geoJSON(null, {
			style: EwaysStyle,
			onEachFeature: function(feature, layer) {
				var popupTxt = "You clicked a great feature!";
				layer.bindPopup(popupTxt);
			}
		});

		$.getJSON(EwaysURL, function(data){
			EwaysLayer.addData(data).addTo(map);
			
		});
		
		// Set style for ways
		var EbuildingsStyle = {
			color: "#E22B2B", 
			weight: 5, 
			opacity: 0.70
		};

		// Add ways layer
		var EbuildingsLayer = L.geoJSON(null, {
			style: EbuildingsStyle,
			onEachFeature: function(feature, layer) {
				var popupTxt = "You clicked a great feature!";
				layer.bindPopup(popupTxt);
			}
		});

		$.getJSON(EbuildingsURL, function(data){
			EbuildingsLayer.addData(data).addTo(map);
		})
		

		// Add the layers to their layer group
		var baseMaps = {
			"OpenStreetMap": osmTiles,
			"ESRI Imagery": esriImagery
		};
		
		var overlayMaps = {
			"Team O Buildings": buildingsLayer,
			"Team O Ways": OwaysLayer,
			"Team E Ways": EwaysLayer,
			"Team E Builings": EbuildingsLayer
			// Add your layer here with a name!
		};

		// Add a control to turn layers on and off
		L.control.layers(baseMaps, overlayMaps).addTo(map);

		// Let's add a button to go to OpenStreetMap using the visual extent
		L.Control.Button = L.Control.extend({
		    options: {
		        position: 'topleft'
		    },
		    onAdd: function (map) {
		        var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
		        var button = L.DomUtil.create('a', 'leaflet-control-button', container);
		        L.DomEvent.disableClickPropagation(button);
		        L.DomEvent.on(button, 'click', function(){
		            var osmURL = `https://www.openstreetmap.org/#map=${map.getZoom()}/${map.getCenter().lat}/${map.getCenter().lng}`;
		            window.open(osmURL, '_blank');
		        });

		        button.innerHTML = '<img style="max-width:100%; max-height:100%" src="img/osm.png">';

		        container.title = "View on OpenStreetMap";

		        return container;
		    },
		    onRemove: function(map) {},
		});
		var control = new L.Control.Button()
		control.addTo(map);

		/* Functions */
		function onEachFeature(feature, layer){
			// Do something to each feature/layer when loaded
		}

		function onMapClick(e) {			
			console.log(e.latlng.toString());
		}

	</script>

</body>
</html>
